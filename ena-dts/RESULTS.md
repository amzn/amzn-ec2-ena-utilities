# Test results

* DPDK v20.08
* Pktgen v20.09.0
* ami: Amazon Linux 2 AMI (HVM), SSD Volume Type - ami-0fc970315c2d38f01

## c5n.18xlarge - instances in the same placement group (cluster)

For this scenario, both test_perf_bw and test_perf_latency were executed. Maximum
flow rate will be capped according to EC2 limits (e.g. for TCP it's up to 10 Gbps per flow).
Additionally rate can be limited by the queue capacity. For the best results the user
should avoid hitting these potential bottlenecks by spreading the flows evenly over
the maximum number of available queues.

The results contain only UDP traffic performance, but they are comparable to the
TCP in terms of PPS and bandwidth when considered without influence of the
networking stack.

### Test case: test_perf_bw

#### Bidirectional

The below results are most comprehensive but it's also possible to run monodirectional test.

Command:

```
./dts --BW-flows 1,8,32,64,256 --BW-sizes 64,1500,9000 --BW-queue 32 --BW-direction bi --BW-types UDP
```

These testcases demonstrate the performance with various common packets sizes over different number of queues.
In addition, it shows that pushing more than a single flow to a queue can increase the overall performance.
See the second table below for a more detailed correlation between the number of flows and queue.

Test results:

```
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| direction      | size | flows | Tx queues DUT / Tester | type | Rx on DUT, Gb/s | Rx on Tester, Gb/s | Rx on DUT, Mpps | Rx on Tester, Mpps |
+================+======+=======+========================+======+=================+====================+=================+====================+
| Tester <=> DUT | 64   | 1     | 1 / 1                  | udp  | 0.671           | 0.656              | 0.998           | 0.976              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 8     | 8 / 8                  | udp  | 2.655           | 1.981              | 3.951           | 2.948              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 32    | 32 / 32                | udp  | 3.008           | 3.084              | 4.476           | 4.590              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 64    | 32 / 32                | udp  | 3.121           | 3.087              | 4.644           | 4.594              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 256   | 32 / 32                | udp  | 3.367           | 3.341              | 5.011           | 4.972              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 1     | 1 / 1                  | udp  | 8.168           | 8.006              | 0.672           | 0.658              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 8     | 8 / 8                  | udp  | 39.933          | 32.347             | 3.284           | 2.660              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 32    | 32 / 32                | udp  | 46.842          | 48.248             | 3.852           | 3.968              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 64    | 32 / 32                | udp  | 50.163          | 48.798             | 4.125           | 4.013              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 256   | 32 / 32                | udp  | 46.668          | 55.186             | 3.838           | 4.538              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 1     | 1 / 1                  | udp  | 8.359           | 8.152              | 0.116           | 0.113              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 8     | 8 / 8                  | udp  | 56.990          | 63.406             | 0.790           | 0.879              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 32    | 32 / 32                | udp  | 90.241          | 90.449             | 1.251           | 1.253              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 64    | 32 / 32                | udp  | 91.352          | 85.096             | 1.266           | 1.179              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 256   | 32 / 32                | udp  | 90.037          | 91.067             | 1.248           | 1.262              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
```

Command:

```
./dts --BW-flows 1,2,4,8 --BW-sizes 64,1500,9000 --BW-queue 1 --BW-direction bi --BW-types UDP
```

These testcases demonstrate the different, packet-size-dependent effects of increasing flows number over a single queue.

Test results:

```
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| direction      | size | flows | Tx queues DUT / Tester | type | Rx on DUT, Gb/s | Rx on Tester, Gb/s | Rx on DUT, Mpps | Rx on Tester, Mpps |
+================+======+=======+========================+======+=================+====================+=================+====================+
| Tester <=> DUT | 64   | 1     | 1 / 1                  | udp  | 0.610           | 0.572              | 0.908           | 0.851              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 2     | 1 / 1                  | udp  | 0.667           | 0.655              | 0.993           | 0.975              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 4     | 1 / 1                  | udp  | 0.668           | 0.673              | 0.994           | 1.001              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 64   | 8     | 1 / 1                  | udp  | 0.671           | 0.571              | 0.999           | 0.850              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 1     | 1 / 1                  | udp  | 8.168           | 8.027              | 0.672           | 0.660              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 2     | 1 / 1                  | udp  | 11.268          | 11.091             | 0.927           | 0.912              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 4     | 1 / 1                  | udp  | 11.732          | 11.469             | 0.965           | 0.943              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 1500 | 8     | 1 / 1                  | udp  | 11.577          | 9.991              | 0.952           | 0.822              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 1     | 1 / 1                  | udp  | 8.046           | 8.112              | 0.112           | 0.112              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 2     | 1 / 1                  | udp  | 16.142          | 15.769             | 0.224           | 0.219              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 4     | 1 / 1                  | udp  | 32.272          | 32.449             | 0.447           | 0.450              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
| Tester <=> DUT | 9000 | 8     | 1 / 1                  | udp  | 49.209          | 49.742             | 0.682           | 0.689              |
+----------------+------+-------+------------------------+------+-----------------+--------------------+-----------------+--------------------+
```

### Test case: test_perf_latency

Command:

```
./dts -t test_perf_latency
```

Test results:

```
+------+---------+---------+---------+-------------+
| size | p50, us | p90, us | p99, us | pkt loss, % |
+======+=========+=========+=========+=============+
| 64   | 25      | 27      | 30      | 0           |
+------+---------+---------+---------+-------------+
| 1500 | 29      | 30      | 34      | 0           |
+------+---------+---------+---------+-------------+
| 9000 | 46      | 48      | 51      | 0           |
+------+---------+---------+---------+-------------+
```
